# build the app in a separate build container
FROM node:lts-slim as build
# Permission for app
RUN mkdir /app && chown node:node /app
WORKDIR /app
COPY --chown=node:node . .
ENV PATH="./node_modules/.bin:$PATH"
USER node
RUN npm ci --no-optional && npm cache clean --force && npm run build

# the deployment container
FROM nginx:alpine
COPY Dockerfile.nginx.config /etc/nginx/conf.d/default.conf
# swap these two lines to use a local build or to utilize the docker build image
COPY --from=build /app/dist /usr/share/nginx/html
#COPY dist /usr/share/nginx/html

# USER nobody

EXPOSE 80

CMD ["/bin/sh",  "-c",  "exec nginx -g 'daemon off;'"]
